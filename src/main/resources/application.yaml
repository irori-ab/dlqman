quarkus:
  http:
    port: 8000
  log:
    level: INFO
    category:
      "se.irori":
        level: INFO

#  kafka:
#    devservices:
#      image-name: docker.io/vectorized/redpanda:v22.3.11
#      port: 9992
#      topic-partitions:
#        dlq-source: 1
#        dlq-override: 1
#        dlq-resend: 1
#  hibernate-orm:
#    log:
#      sql: false
#    database:
#      generation: drop-and-create
#    metrics:
#      enabled: false
  datasource:
    db-kind: postgresql
    reactive:
      max-size: 20
#    devservices:
#      port: 5433
#      db-name: dlqman
  micrometer:
    binder:
      kafka:
        enabled: true
      vertx:
        enabled: true

dlqman:
  kafka:
    common:
      "bootstrap.servers": localhost:9992
    consumer:
      "group.id": dlqman
      "key.deserializer": org.apache.kafka.common.serialization.ByteArrayDeserializer
      "value.deserializer": org.apache.kafka.common.serialization.ByteArrayDeserializer
      "auto.offset.reset": earliest
      "enable.auto.commit": true
    poll-timeout: 2000

"%dev":
  quarkus:
    log:
      level: INFO
      category:
        "se.irori":
          level: INFO
    kafka:
      devservices:
        image-name: docker.io/vectorized/redpanda:v22.3.11
        port: 9992
        topic-partitions:
          dlq-source: 1
          dlq-override: 1
          dlq-resend: 1
    hibernate-orm:
      log:
        sql: true
      database:
        generation: drop-and-create
    datasource:
      db-kind: postgresql
      reactive:
        url: postgresql://localhost:5433/dlqman
        max-size: 20
      devservices:
        port: 5433
        db-name: dlqman
  dlqman:
    sources:
      test-source:
        name: test-source
        description: Test source
        source-topic: dlq-source
        resend-topic: dlq-resend
        match-rules:
          - name: save-fatal
            priority: 5
            matcher: exception-is-fatal
            strategy: dismiss
          - name: resend-retryable
            priority: 6
            matcher: exception-is-retryable
            strategy: resend10s
            resend-topic-override: dlq-override
          - name: catchtherest
            priority: 100
            matcher: all
            strategy: void
    matchers:
      - name: exception-is-retryable
        class-name: HeaderRegexMatcher
        config:
          headerName: internal-dlq-exception-class
          regexPattern: .*RetryableException.*
      - name: exception-is-fatal
        class-name: HeaderRegexMatcher
        config:
          headerName: internal-dlq-exception-class
          regexPattern: .*FatalException.*

    dlq-strategies:
      - name: resend10s
        class-name: SimpleResendDLQStrategy
        config:
          nextWaitDuration: 10000
#"%test":
#  dlqman:
#    sources:
#      testsource:
#        name: test-source
#        description: Test source
#        source-topic: dlq-source
#        resend-topic: dlq-resend
#        match-rules:
#          - name: ignore-mine
#            priority: 5
#            matcher: dismiss-matcher
#            strategy: dismiss
#            resend-topic-override: dlq-override
#          - name: resend-theirs
#            priority: 6
#            matcher: resend-matcher
#            strategy: resend10s
#            resend-topic-override: dlq-override
#          - name: ignore-rest
#            priority: 100
#            matcher: all
#            strategy: dismiss
#      consumer-test:
#        name: consumer-test
#        enabled: false
#        description: Test source
#        source-topic: consumer-test
#        resend-topic: dlq-resend
#        match-rules:
#          - name: dismiss-mine
#            priority: 5
#            matcher: dismiss-matcher
#            strategy: dismiss
#            resend-topic-override: dlq-override
#          - name: resend-theirs
#            priority: 6
#            matcher: resend-matcher
#            strategy: resend10s
#            resend-topic-override: dlq-override
#          - name: dismiss-rest
#            priority: 100
#            matcher: all
#            strategy: dismiss
#    matchers:
#      - name: dismiss-matcher
#        class-name: HeaderRegexMatcher
#        config:
#          headerName: myheader
#          regexPattern: dismiss
#      - name: resend-matcher
#        class-name: HeaderRegexMatcher
#        config:
#          headerName: myheader
#          regexPattern: resend
#
#    dlq-strategies:
#      - name: resend10s
#        class-name: SimpleResendDLQStrategy
#        config:
#          nextWaitDuration: 10000
#    publish-consumed-messages: true
#  mp:
#    messaging:
#      outgoing:
#        dlq-source:
#          connector: smallrye-kafka
#          merge: true
#      incoming:
#        dlq-override:
#          connector: smallrye-kafka
#          value.deserializer: org.apache.kafka.common.serialization.ByteArrayDeserializer

